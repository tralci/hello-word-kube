version: '1.0'
steps:
  BuildingImage:
    title: Building Docker Image
    type: build
    image_name: tralci/hello-world-kube
    working_directory: ./
    tag: '${{CF_BRANCH}}-${{CF_SHORT_REVISION}}'
    dockerfile: ./Dockerfile
    when:
      condition:
        all:
          CheckCiInCommitMessage: 'includes(lower("${{CF_COMMIT_MESSAGE}}"), "check ci") == true'
  UnitTests:
    image: '${{BuildingDockerImage}}' # image that contains installed tools for performing test commands
    commands:
      - echo $(date)
    on_success:
      metadata:
        set:
          - '${{BuildingDockerImage}}':
              - CF_QUALITY: true
    on_fail:
      metadata:
        set:
          - '${{BuildingDockerImage}}':
              - CF_QUALITY: false
    when:
      condition:
        all:
          CheckCiInCommitMessage: 'includes(lower("${{CF_COMMIT_MESSAGE}}"), "check ci") == true'
